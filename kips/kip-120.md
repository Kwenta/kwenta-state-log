---
kip: 117
title: zkVIP Program
status: Draft
created: 2024-03-07
---

## Summary
Create an onchain VIP program that provides fee rebates in OP.
## Abstract
To incentivize larger volume drivers to stick around on Kwenta -- introduce favorable fee rebate program for traders that meet specific volume tiers for a given month. Use ZK-coprocessing to run this rewards program fully onchain.
## Motivation
Most other CEXs and DEXs have some sort of loyalty program that provides discounts to larger, recurring traders. To compete with centralized exchange and encourage platform loyalty Kwenta needs to offer fee rebates to high volume traders. Optimism has provided grants for growth and distribution through a VIP program can be more effective than a flat incentives program because it entitles traders to higher rewards as they drive more volume. 

There are two ways to use historical data onchain. The first is to proactively push historical data to the chain as it's created (aka transaction time). However, this approach requires forward thinking (would have had to be done before the smart contract was deployed) and is also costly to store batches of data onchain that may only be used once or twice and replicated for each user. 

The second way is to aggregate and pull historical data offchain, and use this to execute actions onchain. For example, claiming onchain rewards using historical fees paid aggregated by a subgraph indexed offchain. This is how Kwenta trading rewards works today. The downside of this approach is that requires honest actors (for example Kwenta) to provide data that hasn't been manipulated. 

The third, and hybrid approach, is to still aggregate data offchain, but use recent advancements in Zero Knowledge Proofs (ZKP). ZKPs are used to prove the underlying data hasn't been tampered with, which then can be verified by the blockchain, and if valid, subsequent actions can be executed. This VIP program explores a new way to do trading incentives in a robust, transparent, permissionless way. 
## Specification
Using the OP received from Optimism for growth grants, rebate larger, recurring traders in a VIP program. The program opt-in is automatic and requires no effort from a trader other than claiming their monthly rebates. Volume tiers and eligibility will be surfaced on the UI. Program will be run on Perps V2 until OP incentives run out. After which, the program effectiveness will be re-evaluated and substituted with KWENTA and other rewards on Perps V3 and the Arbitrum-Perennial integration. 

This VIP rewards program will only apply to Perps V2 at the moment because Perps V2 is the only deployment on Optimism network.
### Volume Tiers
| Tier | 30 Day Volume | Fee Rebate |
| ---- | ---- | ---- |
| 0 | >$100,000 | 20% |
| 1 | >$1,000,000 | 50% |
| 2 | >$10,000,000 | 75% |
| 3 | >$100,000,000 | 90% |
### Architecture
Using a ZK-coprocessing service like Brevis or Axiom, prove access to historical chain data regarding volume and fees paid.
#### 1. Data Query
First step is pulling historical data using Brevis/Axiom SDK.

For volume, pull and aggregate transaction/event data over a specific window of time for a given trader. For example, grab total volume over the month of February by summing all trades (notional value changes) during that time period.

For fees, pull and aggregate event data containing fees paid to Synthetix over the same window of time for a given trader. Necessary to determine how much of a rebate a trader will receive. 

> Previously including keeper fees would be an issue because traders could submit un-fillable orders to accumulate keeper fees (which is a deposit refunded to them). However, Keeper fees can be included in this calculation because a trader will have to do substantial volume to even be eligible for a rebate.
#### 2. Proof Generation
Submit historical offchain data to one of the ZK-coprocessing services for proof generation. Proving is computationally expensive and cannot be done within the browser. These proving services have the hardware capabilities to generate proofs for historical data. However, it is still tamper resistant as the proof still needs to be verified onchain (verifying that the historical data pulled did in fact occur onchain).
#### 3. Proof Verification
Create a smart contract onchain that verifies a proof generated by the previous entity. Run the proof received by the prover through the verification function. Once verified, perform a callback to the original claim. For example, once the proof of volume tier is reached for a given epoch, rebate the % tier in fees paid back to the trader.

Only allow claiming of fee rebates for the previous epoch (week) to prevent partial claims.
### Oracle
The rebate contract will have OP ready for reimbursement. To convert the OP to dollar amounts to match up with fees paid, use an onchain oracle from either Pyth or Chainlink to determine the OP amount for the rebate. Latency is not a concern here because there's not much benefit to frontrunning an oracle, however, resiliency to manipulation is critical (hence a proven oracle provider).
## Copyright

Copyright and related rights waived via [CC0](https://creativecommons.org/publicdomain/zero/1.0/).
