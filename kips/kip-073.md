---
kip: 73
title: Smart Margin Account Upgrade v2.0.1
status: Implemented
created: 2023-04-17
section: 4
snapshot: https://snapshot.org/#/kwenta.eth/proposal/0x8e28acd3882d049a5b35dc67cc0909ce8964c2e793e5e12a0f09fdc430d9932e
---

## Summary

This KIP proposes upgrading Smart Margin (SM) accounts to improve risk management and resolve several small non-logic audit findings.

## Motivation

Implementing SM has necessitated adopting risk management measures to mitigate unforeseen account behavior during upgrades to the Synthetix system and Kwenta's. Specifically, the capability to suspend command execution has been identified as a crucial tool for ensuring system stability. Additionally, integrating a pause feature in SM account trading would offer an extra layer of security to safeguard against potential losses due to smart contract exploits.

Audit findings of v2.0.0 not addressed in the original release have also been resolved in this upgrade. These findings are non-logic related.

## Specification

Our margin engine system will add a new contract, `Settings.sol`, which will be owned and can set a parameter `accountExecutionEnabled` that will directly affect the execution of commands in the `Account.sol` contract. The execution lock will allow the system to suspend all command execution for all accounts in the system, and the lock will be used in the event of a system-wide upgrade or emergency. Furthermore, conditional order execution will also be disabled during system suspension.

Audit findings addressed in this upgrade include missing indexed attributes for conditional order events and documentation improvements. Additionally, conditional order IDs are now indexed, and the task ID generated by Gelato is now included in related events.